private async Task GetOfficeVersionAsync(string machineName, ScanStatus scanStatus, CancellationToken cancellationToken)
{
    try
    {
        string officeVersion = "Not Installed";
        string registryPath = @"SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall";

        using (RegistryKey baseKey = RegistryKey.OpenRemoteBaseKey(RegistryHive.LocalMachine, machineName))
        using (RegistryKey uninstallKey = baseKey.OpenSubKey(registryPath))
        {
            if (uninstallKey != null)
            {
                foreach (string subKeyName in uninstallKey.GetSubKeyNames())
                {
                    if (subKeyName.StartsWith("O365ProPlusRetail") || 
                        subKeyName.StartsWith("ProPlus") ||
                        subKeyName.Contains("Office"))
                    {
                        using (RegistryKey officeKey = uninstallKey.OpenSubKey(subKeyName))
                        {
                            if (officeKey != null)
                            {
                                string displayName = officeKey.GetValue("DisplayName") as string;
                                string displayVersion = officeKey.GetValue("DisplayVersion") as string;

                                if (!string.IsNullOrEmpty(displayName) && !string.IsNullOrEmpty(displayVersion))
                                {
                                    officeVersion = $"{displayName} ({displayVersion})";
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }

        scanStatus.MicrosoftOfficeVersion = officeVersion;
    }
    catch (Exception ex)
    {
        Logger.Log(LogLevel.ERROR, $"Error getting Microsoft Office version for {machineName}: {ex.Message}", context: "GetOfficeVersionAsync");
        scanStatus.MicrosoftOfficeVersion = "Error";
    }
}
